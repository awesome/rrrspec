TasksetRef : Reference
TaskRef : Reference
TrialRef : Reference
TrialStatus : ['error', 'timeout', 'failed', 'pending', 'passed']
StdOut : String
StdErr : String
PassedCount : Maybe Int
PendingCount : Maybe Int
FailedCount : Maybe Int
SpecPath : String
HardTimeoutSec : Int
SoftTimeoutSec : Int
RSyncName : String
WorkerLogRef : Reference
SetupCommand : String
SlaveCommand : String
SlaveName : String
SlaveRef : Reference
MaxTrials : Int
TasksetStatus : ['waiting', 'running', 'succeeded', 'cancelled', 'finished']
Task : (SpecPath, SpecSHA1, HardTimeoutSec, SoftTimeoutSec)
SpecSHA1 : String
AverageSec : Int

# Master

## Notification

listen_to_global : () -> ()
listen_to_taskset : TasksetRef -> ()

## SpecAverageSec

query_spec_average_sec : SpecSHA1 -> AverageSec

## Taskset

create_taskset : (RSyncName, SetupCommand, SlaveCommand, WorkerType, TasksetClass, MaxWorkers, MaxTrials, [Task]) -> TasksetRef
dequeue_task : TasksetRef -> Maybe (TaskRef, SpecPath, HardTimeoutSec, SoftTimeoutSec)
try_finish_taskset : TasksetRef -> ()
fail_taskset : TasksetRef -> ()
cancel_taskset : TasksetRef -> ()
cancel_user_taskset : RSyncName -> ()
query_taskset_status : TasksetRef -> TasksetStatus

## Task

reversed_enqueue_task : TaskRef -> ()

## Trial

create_trial : TaskRef -> SlaveRef -> TrialRef
start_trial : TrialRef -> ()
finish_trial : TrialRef -> TrialStatus -> StdOut -> StdErr -> PassedCount -> PendingCount -> FailedCount -> ()

## Worker

current_taskset : WorkerName -> WorkerType -> Maybe TasksetRef -> ()

## WorkerLog

create_worker_log : WorkerName -> TasksetRef -> WorkerLogRef
append_worker_log_log : WorkerLogRef -> String -> ()
set_rsync_finished_time : WorkerLogRef -> ()
set_setup_finished_time : WorkerLogRef -> ()
set_rspec_finished_time : WorkerLogRef -> ()

## Slave

create_slave : SlaveName -> TasksetRef -> SlaveRef
current_trial : SlaveRef -> Maybe TrialRef -> ()
finish_slave : SlaveRef -> Status -> ()
force_finish_slave : SlaveName -> Status -> ()

# Worker

assign_taskset : TasksetRef -> RSyncName -> SetupCommand -> SlaveCommand -> MaxTrials -> ()
cancel_current_execution : () -> ()
query_taskset : () -> TasksetRef

------------

# TasksetNotification

taskset_updated : Timestamp -> TasksetRef -> Hash -> ()
task_updated : Timestamp -> TaskRef -> Hash -> ()
trial_created : Timestamp -> TrialRef -> TaskRef -> SlaveRef -> CreatedAt -> ()
trial_updated : Timestamp -> TrialRef -> TaskRef -> FinishedAt -> TrialStatus -> PassedCount -> PendingCount -> FailedCount -> ()
worker_log_created : Timestamp -> WorkerLogRef -> WorkerName -> ()
worker_log_updated : Timestamp -> WorkerLogRef -> Hash -> ()
slave_created : Timestamp -> SlaveRef -> SlaveName -> ()
slave_updated : Timestamp -> SlaveRef -> Hash -> ()

# GlobalNotification

taskset_created : Timestamp -> TasksetRef -> CreatedAt -> RSyncName -> WorkerType -> TasksetClass -> ()
taskset_updated : Timestamp -> TasksetRef -> Hash -> ()
